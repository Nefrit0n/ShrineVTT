<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ShrineVTT — Святилище</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Shippori+Mincho+B1:wght@500;600;700&display=swap"
    rel="stylesheet" />

  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div class="page">
    <div class="bg" aria-hidden="true"></div>

    <header class="topbar">
      <div class="brand" aria-label="ShrineVTT">
        <span class="brand__crest" aria-hidden="true">⛩︎</span>
        <div class="brand__lockup">
          <h1 class="brand__title">ShrineVTT</h1>
          <p class="brand__subtitle">Лунные хроники</p>
        </div>
      </div>

      <div class="topbar__panel">
        <div class="status">
          <div class="status__item status__item--connection">
            <span class="status__icon" aria-hidden="true">☯︎</span>
            <div class="status__stack">
              <span class="label">Соединение</span>
              <span id="connection-status" class="pill pill--danger" title="Состояние WebSocket">НЕ В СЕТИ</span>
            </div>
          </div>
          <div class="status__item status__item--role">
            <span class="status__icon" aria-hidden="true">狐</span>
            <div class="status__stack">
              <span class="label">Роль</span>
              <span id="role-indicator" class="pill">ГОСТЬ</span>
            </div>
          </div>
        </div>
        <div class="session-controls">
          <button id="create-session-btn" class="btn btn--primary session-controls__action" type="button" hidden>
            Создать сессию
          </button>
          <button id="load-session-btn" class="btn btn--secondary session-controls__action" type="button" hidden>
            Загрузить сессию
          </button>
          <div id="session-chip" class="session-chip" hidden>
            <div class="session-chip__info">
              <span class="session-chip__label">Код</span>
              <span id="session-code" class="session-chip__code">—</span>
            </div>
            <div class="session-chip__actions">
              <button id="session-copy-btn" class="session-chip__action" type="button">Копировать</button>
              <button id="session-invite-btn" class="session-chip__action" type="button">Пригласить</button>
              <button id="leave-session-btn" class="session-chip__action" type="button">
                Выйти из сессии
              </button>
            </div>
          </div>
          <button id="logout-btn" class="btn btn--ghost session-controls__action" type="button" hidden>
            Выйти из роли
          </button>
        </div>
      </div>
    </header>

    <main class="main">
      <aside class="pillar">
        <section class="pillar__section" data-visible="GUEST">
          <header class="pillar__header">
            <h2 class="pillar__title">Вход в святилище</h2>
            <p class="pillar__hint">Выберите свою роль, чтобы начать сессию.</p>
          </header>
          <div class="pillar__actions">
            <button id="gm-login-open" class="btn btn--primary">Стать Мастером</button>
            <button id="join-open" class="btn btn--secondary">Присоединиться как Игрок</button>
          </div>
        </section>

        <section class="pillar__section" data-visible="MASTER" hidden>
          <header class="pillar__header">
            <h2 class="pillar__title">Панель Мастера</h2>
            <p class="pillar__hint">Быстрые инструменты управления сессией.</p>
          </header>
          <ul class="tool-list tool-list--grid">
            <li class="tool-list__item">
              <div>
                <span class="tool-list__label">Карта и туман</span>
                <p class="tool-list__meta">Подготовьте сцену и отметьте её активной для игроков.</p>
              </div>
              <form id="create-scene-form" class="scene-form">
                <div class="scene-form__row">
                  <label class="field scene-form__field" for="scene-name-input">
                    <span class="field__label">Название</span>
                    <input
                      id="scene-name-input"
                      name="name"
                      class="field__input"
                      type="text"
                      placeholder="Лунный зал"
                      autocomplete="off"
                      required
                    />
                  </label>
                </div>
                <div class="scene-form__row scene-form__row--grid">
                  <label class="field scene-form__field" for="scene-grid-input">
                    <span class="field__label">Размер клетки (px)</span>
                    <input
                      id="scene-grid-input"
                      name="gridSize"
                      class="field__input"
                      type="number"
                      min="10"
                      step="10"
                      value="100"
                      required
                    />
                  </label>
                  <label class="field scene-form__field" for="scene-width-input">
                    <span class="field__label">Ширина (px)</span>
                    <input
                      id="scene-width-input"
                      name="widthPx"
                      class="field__input"
                      type="number"
                      min="100"
                      step="50"
                      value="1400"
                      required
                    />
                  </label>
                  <label class="field scene-form__field" for="scene-height-input">
                    <span class="field__label">Высота (px)</span>
                    <input
                      id="scene-height-input"
                      name="heightPx"
                      class="field__input"
                      type="number"
                      min="100"
                      step="50"
                      value="1000"
                      required
                    />
                  </label>
                </div>
                <div class="scene-form__actions">
                  <button id="create-scene-submit" class="btn btn--primary scene-form__submit" type="submit">
                    Создать
                  </button>
                </div>
              </form>
              <p id="scene-form-status" class="scene-form__status" role="status">
                Создайте или загрузите сессию, чтобы подготовить сцену.
              </p>
              <div id="scene-form-result" class="scene-form__result" hidden>
                <div class="scene-form__summary">
                  <span id="scene-form-result-name" class="scene-form__name"></span>
                  <span id="scene-form-result-badge" class="pill pill--ok" hidden>Активная</span>
                </div>
                <p id="scene-form-result-text" class="scene-form__hint"></p>
                <button id="scene-form-make-active" class="btn btn--secondary scene-form__action" type="button">
                  Сделать активной
                </button>
              </div>
            </li>
            <li class="tool-list__item">
              <span class="tool-list__label">Инициатива</span>
              <span class="tool-list__meta">Подготовьте порядок хода и броски костей.</span>
            </li>
            <li class="tool-list__item">
              <div class="tool-list__info">
                <span class="tool-list__label">Жетоны игроков</span>
                <p class="tool-list__meta">Управляйте появлением, перемещением и состояниями.</p>
              </div>
              <div class="tool-list__actions">
                <button
                  id="gm-drag-toggle"
                  class="btn btn--ghost btn--toggle"
                  type="button"
                  aria-pressed="false"
                  data-label-off="Перетаскивание жетонов: выкл."
                  data-label-on="Перетаскивание жетонов: вкл."
                >
                  Перетаскивание жетонов: выкл.
                </button>
                <p class="tool-list__hint">Активируйте режим, чтобы перемещать миниатюры вручную.</p>
              </div>
            </li>
            <li class="tool-list__item">
              <span class="tool-list__label">Закрытые заметки</span>
              <span class="tool-list__meta">Приватные пометки Мастера будут доступны в следующем обновлении.</span>
            </li>
          </ul>
        </section>

        <section class="pillar__section" data-visible="PLAYER" hidden>
          <header class="pillar__header">
            <h2 class="pillar__title">Панель Игрока</h2>
            <p class="pillar__hint">Контролируйте своего персонажа и взаимодействуйте с картой.</p>
          </header>
          <ul class="tool-list tool-list--grid">
            <li class="tool-list__item">
              <span class="tool-list__label">Жетон персонажа</span>
              <span class="tool-list__meta">Скоро вы сможете размещать и двигать свою миниатюру.</span>
            </li>
            <li class="tool-list__item">
              <span class="tool-list__label">Броски костей</span>
              <span class="tool-list__meta">Канал для мгновенных бросков и истории результатов.</span>
            </li>
            <li class="tool-list__item">
              <span class="tool-list__label">Командные сигналы</span>
              <span class="tool-list__meta">Совместные действия будут доступны в ближайшее время.</span>
            </li>
          </ul>
        </section>

        <section class="pillar__section pillar__section--grow" data-visible="CONNECTED" hidden>
          <header class="pillar__header">
            <h2 class="pillar__title">Полевой журнал</h2>
            <p class="pillar__hint">Фиксируйте идеи и события прямо во время партии.</p>
          </header>
          <div id="player-notes-block" class="journal">
            <label class="journal__field">
              <span class="journal__label">Мои заметки</span>
              <textarea
                id="player-notes"
                class="journal__textarea"
                placeholder="Записывайте подсказки, находки и планы действий"
                rows="10"
              ></textarea>
            </label>
            <div id="player-notes-status" class="journal__status journal__status--idle" role="status" aria-live="polite">
              Подключитесь к сессии, чтобы вести заметки
            </div>
          </div>
        </section>

        <section class="pillar__section" data-visible="CONNECTED" hidden>
          <header class="pillar__header">
            <h2 class="pillar__title">Связь</h2>
            <p class="pillar__hint">Проверьте задержку и стабильность канала.</p>
          </header>
          <div class="pillar__actions pillar__actions--inline">
            <button id="ping-button" class="btn btn--ghost" disabled>Отправить пинг</button>
          </div>
        </section>
      </aside>

        <section class="board" aria-label="Игровое поле">
          <div class="board__frame">
            <canvas id="scene-canvas" class="board__canvas" aria-label="Полотно сцены"></canvas>
            <div class="board__overlay" id="board-overlay" role="status">
              <div class="board__placeholder">
                <p id="board-overlay-title" class="board__placeholder-title">Сцена не выбрана</p>
                <p id="board-overlay-text" class="board__placeholder-text">Сделайте сцену активной или обновите состояние, чтобы увидеть карту.</p>
                <button id="board-overlay-retry" class="btn btn--ghost board__placeholder-action" type="button">
                  Загрузить активную
                </button>
              </div>
            </div>
          </div>
        </section>

      <section class="chronicle" aria-label="Хроника событий">
        <header class="chronicle__header">
          <span class="chronicle__seal" aria-hidden="true">❖</span>
          <h2 class="chronicle__title">Хроника отголосков</h2>
          <span class="chronicle__seal chronicle__seal--right" aria-hidden="true">❖</span>
        </header>
        <div id="log-entries" class="chronicle__log" aria-live="polite">
          <div id="log-empty" class="chronicle__empty">Сообщения появятся здесь, как только начнётся сессия.</div>
        </div>
      </section>
    </main>
  </div>

  <div id="modal-session-saves" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal__backdrop" data-close></div>
    <div class="modal__dialog">
      <header class="modal__header">
        <span class="modal__glyph" aria-hidden="true">✦</span>
        <div>
          <h3 class="modal__title">Выбор сохранения</h3>
          <p class="modal__subtitle">Продолжите предыдущую сессию или переключитесь на другую.</p>
        </div>
        <button class="modal__close" title="Закрыть" data-close aria-label="Закрыть">✕</button>
      </header>
      <div class="modal__body">
        <p id="session-saves-empty" class="session-saves__empty">Войдите как Мастер, чтобы просмотреть сохранения.</p>
        <ul id="session-saves-list" class="session-saves" role="list"></ul>
      </div>
      <footer class="modal__footer">
        <button class="btn btn--ghost" data-close>Отмена</button>
        <button id="session-load-confirm" class="btn btn--primary" disabled>Загрузить</button>
      </footer>
    </div>
  </div>

  <div id="modal-gm" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal__backdrop" data-close></div>
    <div class="modal__dialog">
      <header class="modal__header">
        <span class="modal__glyph" aria-hidden="true">☾</span>
        <div>
          <h3 class="modal__title">Печать Мастера игры</h3>
          <p class="modal__subtitle">Введите пароль хранителя, чтобы получить полный контроль.</p>
        </div>
        <button class="modal__close" title="Закрыть" data-close aria-label="Закрыть">✕</button>
      </header>
      <div class="modal__body">
        <label class="field">
          <span class="field__label">Пароль</span>
          <input id="gm-password" class="field__input" type="password" placeholder="Введите пароль Мастера"
            autocomplete="current-password" />
        </label>
        <p class="hint">Его задаёт хранитель этого мира. Делитесь осмотрительно.</p>
      </div>
      <footer class="modal__footer">
        <button class="btn btn--ghost" data-close>Отмена</button>
        <button id="gm-login-btn" class="btn btn--primary">Войти как Мастер</button>
      </footer>
    </div>
  </div>

  <div id="modal-join" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal__backdrop" data-close></div>
    <div class="modal__dialog">
      <header class="modal__header">
        <span class="modal__glyph" aria-hidden="true">☽</span>
        <div>
          <h3 class="modal__title">Войти в круг</h3>
          <p class="modal__subtitle">Назовите себя и укажите код сессии, выданный Мастером.</p>
        </div>
        <button class="modal__close" title="Закрыть" data-close aria-label="Закрыть">✕</button>
      </header>
      <form id="join-form" class="modal__body modal__body--grid" autocomplete="off">
        <label class="field">
          <span class="field__label">Имя игрока</span>
          <input id="join-username" name="username" class="field__input" type="text"
            placeholder="например, Лунный лис" maxlength="32" required />
        </label>
        <label class="field">
          <span class="field__label">Код сессии</span>
          <input id="join-code" name="code" class="field__input" type="text" placeholder="например, A7R9QZ" maxlength="6"
            inputmode="text" pattern="[A-Za-z0-9]{6}" required />
        </label>
        <p id="join-error" class="form-error" data-join-error hidden></p>
      </form>
      <footer class="modal__footer">
        <button class="btn btn--ghost" type="button" data-close>Отмена</button>
        <button id="join-submit" class="btn btn--primary" type="submit" form="join-form">Присоединиться</button>
      </footer>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script type="module" src="./app.js"></script>
</body>

</html>
